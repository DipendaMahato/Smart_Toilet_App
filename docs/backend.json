{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile, containing personal and medical information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        },
        "gender": {
          "type": "string",
          "description": "User's gender."
        },
        "bloodGroup": {
          "type": "string",
          "description": "User's blood group."
        },
        "height": {
          "type": "number",
          "description": "User's height in centimeters."
        },
        "weight": {
          "type": "number",
          "description": "User's weight in kilograms."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "User's date of birth.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "name",
        "phoneNumber",
        "gender",
        "bloodGroup",
        "height",
        "weight",
        "dateOfBirth"
      ]
    },
    "HealthInsight": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HealthInsight",
      "type": "object",
      "description": "Represents a health insight generated by AI analysis of user data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the HealthInsight entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N HealthInsight)"
        },
        "insightText": {
          "type": "string",
          "description": "The text content of the health insight."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the health insight was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "insightText",
        "timestamp"
      ]
    },
    "SensorData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SensorData",
      "type": "object",
      "description": "Represents data collected from the smart toilet sensors.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SensorData entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N SensorData)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the sensor data was recorded.",
          "format": "date-time"
        },
        "biomarker1": {
          "type": "number",
          "description": "Value of biomarker 1 (e.g., glucose level)."
        },
        "biomarker2": {
          "type": "number",
          "description": "Value of biomarker 2 (e.g., pH level)."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "biomarker1",
        "biomarker2"
      ]
    },
    "EmergencyAlert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EmergencyAlert",
      "type": "object",
      "description": "Represents an emergency alert triggered by health data analysis.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the EmergencyAlert entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N EmergencyAlert)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the alert was triggered.",
          "format": "date-time"
        },
        "alertMessage": {
          "type": "string",
          "description": "The message content of the emergency alert."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "alertMessage"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The path ensures that only the authenticated user can access their profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/healthInsights/{healthInsightId}",
        "definition": {
          "entityName": "HealthInsight",
          "schema": {
            "$ref": "#/backend/entities/HealthInsight"
          },
          "description": "Stores health insights generated for a specific user. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "healthInsightId",
              "description": "The unique identifier for the health insight."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sensorData/{sensorDataId}",
        "definition": {
          "entityName": "SensorData",
          "schema": {
            "$ref": "#/backend/entities/SensorData"
          },
          "description": "Stores sensor data collected from the smart toilet for a specific user. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "sensorDataId",
              "description": "The unique identifier for the sensor data record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/emergencyAlerts/{emergencyAlertId}",
        "definition": {
          "entityName": "EmergencyAlert",
          "schema": {
            "$ref": "#/backend/entities/EmergencyAlert"
          },
          "description": "Stores emergency alerts triggered for a specific user. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "emergencyAlertId",
              "description": "The unique identifier for the emergency alert."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. User profiles and related data (health insights, sensor data, emergency alerts) are stored in a hierarchical structure under the `/users/{userId}` path to enforce ownership and simplify security rules.\n\n**Authorization Independence (Denormalization):**\n*   `HealthInsight`, `SensorData`, and `EmergencyAlert` collections are subcollections of `/users/{userId}`. This allows direct ownership-based security rules without needing to fetch parent user data. The `userId` field in these subcollections ensures that access control can be enforced based on `request.auth.uid == resource.data.userId`.\n\n**Structural Segregation:**\n*   Each collection serves a specific purpose, ensuring homogeneous security posture. User profiles are stored separately from health insights, sensor data, and emergency alerts.\n\n**Access Modeling:**\n*   Private Data: User profiles are stored using path-based ownership (`/users/{userId}/profile`).\n*   User-Owned Data: Health insights, sensor data, and emergency alerts are structured as subcollections of users (`/users/{userId}/healthInsights`, `/users/{userId}/sensorData`, `/users/{userId}/emergencyAlerts`).\n\n**QAPs (Rules are not Filters):**\n*   The structure enables secure `list` operations for user-specific data because each subcollection is directly tied to a user's ID. Security rules can efficiently filter based on `request.auth.uid` without needing to iterate through documents or use complex queries.\n\n**Invariants:**\n*   The `userId` field in the subcollections maintains the integrity of ownership. Timestamps are included for all time-sensitive data (health insights, sensor data, emergency alerts)."
  }
}